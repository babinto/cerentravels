<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>ceren travels</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        margin: 0;
        font-family: 'Helvetica Neue', sans-serif;
      }
      #map {
        height: 100vh;
        width: 100vw;
      }
      #searchBox {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        background: #fff;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }
      #searchInput {
        width: 250px;
        padding: 6px;
        font-size: 16px;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
  </head>
  <body>
    <div id="searchBox">
      <input type="text" id="searchInput" placeholder="ceren travels to..." />
      <button onclick="searchCity()">Add</button>
    </div>
    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

    <script>
      // Firebase ayarların (senin verdiğin config)
      const firebaseConfig = {
        apiKey: "AIzaSyCD_PLUZ_SAdlzOsqWWjzhi8voYUGd7ftE",
        authDomain: "ceren-travels.firebaseapp.com",
        projectId: "ceren-travels",
        storageBucket: "ceren-travels.firebasestorage.app",
        messagingSenderId: "579239744378",
        appId: "1:579239744378:web:2b034208cf0842cb6cfcc3"
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      const map = L.map('map').setView([20, 0], 2);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      function createMarker(doc) {
        const marker = L.marker([doc.lat, doc.lng], { draggable: false }).addTo(map);
        marker.bindPopup(`<strong>${doc.name}</strong><br>${doc.date}<br>${doc.notes}`);
      }

      async function loadMarkers() {
        const snapshot = await db.collection("markers").get();
        snapshot.forEach(doc => {
          createMarker(doc.data());
        });
      }

      loadMarkers();

      map.on('click', async function (e) {
        const name = prompt("City name:");
        if (!name) return;
        const notes = prompt("Notes:");
        const date = prompt("Date of visit (e.g. 2024-05-29):");
        const data = {
          lat: e.latlng.lat,
          lng: e.latlng.lng,
          name,
          notes: notes || '',
          date: date || ''
        };
        await db.collection("markers").add(data);
        createMarker(data);
      });

      async function searchCity() {
        const city = document.getElementById("searchInput").value;
        if (!city) return;
        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}`);
        const data = await res.json();
        if (data.length > 0) {
          const { lat, lon, display_name } = data[0];
          const notes = prompt("Notes:");
          const date = prompt("Date of visit (e.g. 2024-05-29):");
          const cityData = {
            lat: parseFloat(lat),
            lng: parseFloat(lon),
            name: display_name,
            notes: notes || '',
            date: date || ''
          };
          await db.collection("markers").add(cityData);
          createMarker(cityData);
          map.setView([lat, lon], 5);
          document.getElementById("searchInput").value = "";
        } else {
          alert("City not found.");
        }
      }
    </script>
  </body>
</html>
